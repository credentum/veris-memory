# VoiceBot Extension
# Simple browser-based voice assistant with Veris Memory integration
#
# Use with main docker-compose.yml:
# docker compose -f docker-compose.yml -f docker-compose.voice.yml up -d
#
# Features:
# - Browser VAD (Voice Activity Detection)
# - OpenAI Whisper STT + TTS
# - Veris Memory integration for persistent context
# - Claude Agent integration for code tasks
# - Smart fact extraction and storage

services:
  voice-bot:
    build:
      context: ./voice-bot
      dockerfile: Dockerfile
    container_name: voice-bot
    ports:
      - "8002:8000"  # Expose on port 8002 (internal 8000)
    environment:
      # OpenAI Configuration (required)
      - OPENAI_API_KEY=${OPENAI_API_KEY}

      # Veris Memory Connection
      - MEMORY_API_BASE=http://context-store:8000
      - API_KEY_VOICEBOT=${API_KEY_VOICEBOT}

      # User Configuration
      - VOICE_USER_ID=${VOICE_USER_ID:-matt}

      # Debug (set to 1 for verbose logging)
      - DEBUG_MEMORY=${DEBUG_MEMORY:-0}

      # Claude Agent repo paths (optional, for code review via voice)
      - REPO_VOICEBOT=/opt/veris-memory/voice-bot
      - REPO_VERIS=/opt/veris-memory
      - DEFAULT_REPO_PATH=/opt/veris-memory
    depends_on:
      context-store:
        condition: service_healthy
    networks:
      - context-store-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    volumes:
      # Mount app code for hot-reload during development
      - ./voice-bot/app:/app/app:ro
      - ./voice-bot/frontend:/app/frontend:ro

# Networks (uses existing network from main docker-compose.yml)
networks:
  context-store-network:
    external: false
    name: veris-memory-dev_context-store-network
