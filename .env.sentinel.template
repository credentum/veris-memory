# Veris Memory Sentinel Configuration Template
# Copy this file to .env.sentinel and fill in your values
#
# PR #397: Check Frequency Optimization
# =====================================
# Checks are now categorized into three groups:
#
# RUNTIME CHECKS (continuous monitoring):
#   S1-probes: 1 minute - health probes (critical)
#   S11-firewall-status: 5 minutes - security monitoring
#
# SPOT-CHECK MONITORS (hourly validation):
#   S2-golden-fact-recall: 1 hour - data quality
#   S5-security-negatives: 1 hour - security validation
#   S6-backup-restore: 6 hours - backup verification
#   S10-content-pipeline: 1 hour - pipeline health
#
# CI/CD-ONLY (disabled at runtime, run on deploy):
#   S3-paraphrase-robustness: validates semantic search quality
#   S4-metrics-wiring: validates observability infrastructure
#   S7-config-parity: validates environment configuration
#   S8-capacity-smoke: validates performance baselines
#   S9-graph-intent: validates schema relationships
#
# To enable CI/CD-only checks locally for testing:
#   SENTINEL_ENABLED_CHECKS=S1-probes,S2-golden-fact-recall,S3-paraphrase-robustness,...
#   SENTINEL_INTERVAL_S3=300  # Run S3 every 5 minutes for testing

# ===================================
# TELEGRAM CONFIGURATION
# ===================================
# Bot token from @BotFather on Telegram
TELEGRAM_BOT_TOKEN=YOUR_BOT_TOKEN_HERE

# Chat ID where alerts will be sent
# To get your chat ID:
# 1. Send a message to your bot
# 2. Visit: https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
# 3. Look for "chat":{"id": <YOUR_CHAT_ID>}
TELEGRAM_CHAT_ID=YOUR_CHAT_ID_HERE

# Enable/disable Telegram alerting
TELEGRAM_ENABLED=true

# Rate limit for Telegram messages (messages per minute)
TELEGRAM_RATE_LIMIT=30

# ===================================
# GITHUB INTEGRATION
# ===================================
# GitHub personal access token with repo and issues permissions
GITHUB_TOKEN=YOUR_GITHUB_TOKEN_HERE

# Repository for issue creation
GITHUB_REPO=credentum/veris-memory

# Enable/disable GitHub issue creation
GITHUB_ISSUES_ENABLED=false

# Labels to apply to auto-created issues
GITHUB_ISSUE_LABELS=sentinel,automated,monitoring

# ===================================
# ALERT CONFIGURATION
# ===================================
# Deduplication window in minutes (avoid duplicate alerts)
ALERT_DEDUP_WINDOW_MIN=30

# Number of failures before alerting
ALERT_THRESHOLD_FAILURES=3

# Summary interval in hours (how often to send summaries)
SUMMARY_INTERVAL_HOURS=24

# ===================================
# CHECK-SPECIFIC CONFIGURATION
# ===================================
# S1 Health Probes
S1_HEALTH_ENABLED=true
S1_HEALTH_TIMEOUT_SEC=10

# S2 Golden Fact Recall
S2_GOLDEN_FACT_ENABLED=true
S2_GOLDEN_FACT_TIMEOUT_SEC=15

# S3 Paraphrase Robustness (not yet implemented)
S3_PARAPHRASE_ENABLED=false
S3_PARAPHRASE_TIMEOUT_SEC=30

# S4 Metrics Wiring (not yet implemented)
S4_METRICS_ENABLED=false
S4_METRICS_TIMEOUT_SEC=20

# S5 Security Negatives (not yet implemented)
S5_SECURITY_ENABLED=false
S5_SECURITY_TIMEOUT_SEC=30

# S6 Backup Restore
S6_BACKUP_ENABLED=true
# Note: Backups run every 6 hours, so max age should be >6 to avoid false positives
S6_BACKUP_MAX_AGE_HOURS=8

# S7 Config Parity (not yet implemented)
S7_CONFIG_ENABLED=false
S7_CONFIG_TIMEOUT_SEC=15

# S8 Capacity Smoke (not yet implemented)
S8_CAPACITY_ENABLED=false
S8_CAPACITY_CONCURRENT_REQUESTS=50
S8_CAPACITY_TIMEOUT_SEC=60

# Maximum acceptable response time in milliseconds
# IMPORTANT: Threshold increased from 2000ms to 2500ms (PR #269, PR #274)
#
# Rationale:
# - PR #269 introduced REST compatibility layer with internal HTTP forwarding
# - Request path: Client → REST API → MCP Tool → Backend (extra hop)
# - Measured forwarding overhead: ~300-500ms per request
# - Old threshold (2000ms) would flag false positives for legitimate requests
# - New threshold (2500ms) = Base latency (1500-2000ms) + Forwarding (300-500ms)
#
# Performance Regression Detection:
# - Sentinel tracks both total response time AND application processing time
# - Forwarding overhead is measured separately in metrics endpoint
# - Application-layer performance issues still detectable via /metrics
# - Consider adding S8_APP_LATENCY_MS for application-only threshold
#
# Monitoring Recommendations:
# - Monitor /metrics endpoint for application latency vs forwarding latency breakdown
# - Alert on application latency >1500ms (regression indicator)
# - Alert on forwarding latency >500ms (architecture issue)
S8_MAX_RESPONSE_TIME_MS=2500

# Response time variability threshold (coefficient of variation)
# IMPORTANT: Threshold increased from 1.0 to 1.5 (PR #306) then to 2.5 (2025-11-29)
#
# Rationale for 2.5:
# - Production workloads have natural variability due to:
#   - Database query variance (Neo4j, Qdrant)
#   - Connection pool contention
#   - REST→MCP forwarding overhead (PR #269)
#   - Network latency fluctuations
# - CV of 2.0-2.5 is normal for real-world API performance
# - Lower thresholds (1.0-1.5) caused false positives in production
S8_CV_THRESHOLD=2.5

# Application-only latency threshold (excludes forwarding overhead)
# This allows detection of pure application performance regressions
# independent of REST→MCP forwarding overhead
#
# Usage: When metrics endpoint provides application vs forwarding latency breakdown,
# S8 will validate application latency separately against this threshold
#
# Recommended value: 1500ms (application baseline without forwarding)
# Total response time = APP_LATENCY + FORWARDING_LATENCY
# Example: 1400ms (app) + 400ms (forwarding) = 1800ms (total) ✓ both pass
#          1600ms (app) + 400ms (forwarding) = 2000ms (total) ❌ app threshold exceeded
#
# Note: Currently requires metrics endpoint enhancement to expose latency breakdown
# See: /metrics should return {application_latency_ms, forwarding_latency_ms}
S8_APP_LATENCY_MS=1500

# S9 Graph Intent (not yet implemented)
S9_GRAPH_ENABLED=false
S9_GRAPH_TIMEOUT_SEC=25

# S10 Content Pipeline (not yet implemented)
S10_PIPELINE_ENABLED=false
S10_PIPELINE_TIMEOUT_SEC=20

# ===================================
# SENTINEL RUNNER CONFIGURATION
# ===================================
# Check interval in seconds
CHECK_INTERVAL_SECONDS=300

# Database path for storing results
SENTINEL_DB_PATH=/var/lib/sentinel/sentinel.db

# API port for Sentinel endpoints
SENTINEL_API_PORT=8081

# Enable debug logging
SENTINEL_DEBUG=false

# ===================================
# SERVICE CONNECTION CONFIGURATION
# ===================================
# These are needed for S7 config parity checks and service validation

# Target Veris Memory base URL (context-store service)
TARGET_BASE_URL=http://context-store:8000

# Database connection URL (PostgreSQL)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://veris:password@postgres:5432/veris_memory

# Vector database URL (Qdrant)
QDRANT_URL=http://qdrant:6333

# Graph database URL (Neo4j)
NEO4J_URI=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your_neo4j_password_here

# Cache database URL (Redis)
REDIS_URL=redis://redis:6379

# API service URL
API_URL=http://api:8001

# ===================================
# SECURITY CONFIGURATION
# ===================================
# Host check authentication secret (REQUIRED for production)
# SECURITY: Generate a random secret for production deployments
# Example: openssl rand -hex 32
# DO NOT use the old insecure default: veris_host_check_default_secret_change_me
HOST_CHECK_SECRET=GENERATE_RANDOM_SECRET_HERE

# ===================================
# GENERAL APPLICATION CONFIGURATION
# ===================================
# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Environment name (development, staging, production, test)
ENVIRONMENT=production

# Application version (optional)
APP_VERSION=1.0.0
