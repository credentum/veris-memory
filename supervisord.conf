[supervisord]
nodaemon=true
logfile=/app/data/logs/supervisord.log
pidfile=/app/data/supervisord.pid

[program:redis]
command=redis-server /app/config/redis.conf --daemonize no
autostart=true
autorestart=true
priority=10
stdout_logfile=/app/data/logs/redis.log
stderr_logfile=/app/data/logs/redis.log
# Resource limits for Redis
rlimit_as=536870912  ; 512MB memory limit
rlimit_nofile=1024   ; File descriptor limit

[program:qdrant]
command=/usr/local/bin/qdrant --config-path /app/qdrant.yaml
directory=/app
autostart=true
autorestart=true
priority=20
stdout_logfile=/app/data/logs/qdrant.log
stderr_logfile=/app/data/logs/qdrant.log
environment=QDRANT__SERVICE__HTTP_PORT=6333,QDRANT__SERVICE__GRPC_PORT=6334,QDRANT__STORAGE__STORAGE_PATH=/app/data/qdrant
# Resource limits for Qdrant
rlimit_as=536870912  ; 512MB memory limit
rlimit_nofile=2048   ; File descriptor limit

[program:neo4j]
command=/var/lib/neo4j/bin/neo4j console
directory=/var/lib/neo4j
autostart=true
autorestart=true
priority=30
stdout_logfile=/app/data/logs/neo4j.log
stderr_logfile=/app/data/logs/neo4j.log
# Run as app user (container runs as non-root)
# Resource limits for Neo4j
rlimit_as=1073741824  ; 1GB memory limit
rlimit_nofile=4096    ; File descriptor limit

[program:context-store]
command=python3 -m uvicorn src.mcp_server.main:app --host 0.0.0.0 --port 8000
directory=/app
autostart=true
autorestart=true
priority=40
stdout_logfile=/app/data/logs/context-store.log
stderr_logfile=/app/data/logs/context-store.log
# Resource limits for MCP Server
rlimit_as=268435456   ; 256MB memory limit
rlimit_nofile=1024    ; File descriptor limit

[program:health-monitor]
command=/app/monitoring/health-monitor.sh
directory=/app
autostart=true
autorestart=true
priority=50
stdout_logfile=/app/data/logs/health-monitor.log
stderr_logfile=/app/data/logs/health-monitor.log
# Run health checks every 60 seconds
startsecs=60
startretries=3
